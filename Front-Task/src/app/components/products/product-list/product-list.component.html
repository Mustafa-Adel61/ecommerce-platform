<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Products</h2>
        <a routerLink="/products/create" class="btn btn-primary shadow-sm">
          <i class="bi bi-plus-circle me-2"></i>Add Product
        </a>
      </div>

      <!-- Category Filter -->
      <div class="row mb-4">
        <div class="col-md-4">
          <select 
            class="form-select shadow-sm" 
            (change)="onCategoryChange($any($event.target).value)"
            [value]="selectedCategoryId || ''"
          >
            <option value="">All Categories</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
      </div>

      <!-- Loading Spinner -->
      <div class="text-center my-5" *ngIf="isLoading">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- Error Message -->
      <div class="alert alert-danger shadow-sm" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <!-- Products Grid -->
      <div class="row g-4" *ngIf="!isLoading && !errorMessage">
        <div class="col-lg-3 col-md-4 col-sm-6" *ngFor="let product of products">
          <div class="card h-100 product-card shadow-sm border-0">
            <!-- Image -->
            <div class="card-img-container">
              <img 
                [src]="getFullImageUrl(product.imagePath ?? null)" 
                [alt]="product.name"
                class="card-img-top"
                (error)="$event.target.src='assets/images/placeholder.svg'"
              >
              <div class="discount-badge" *ngIf="product.discountRate > 0">
                -{{ product.discountRate }}%
              </div>
            </div>
            
            <!-- Card Body -->
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ product.name }}</h5>
              <p class="card-text text-muted mb-1">{{ product.categoryName }}</p>
              <p class="card-text">
                <small class="text-muted">Code: {{ product.code }}</small>
              </p>
              
              <!-- Price -->
              <div class="price-section mt-auto">
                <div class="d-flex align-items-center">
                  <span class="current-price me-2" *ngIf="product.discountRate > 0">
                    ${{ calculateDiscountedPrice(product.price, product.discountRate).toFixed(2) }}
                  </span>
                  <span class="original-price" [class.text-decoration-line-through]="product.discountRate > 0">
                    ${{ product.price.toFixed(2) }}
                  </span>
                </div>
                <small class="text-muted">Min Qty: {{ product.minimumQuantity }}</small>
              </div>
            </div>
            
            <!-- Card Footer -->
            <div class="card-footer bg-transparent border-0">
              <div class="btn-group w-100" role="group">
                <button 
                  type="button" 
                  class="btn btn-outline-primary btn-sm"
                  [routerLink]="['/products', product.id]"
                >
                  View
                </button>
                <button 
                  type="button" 
                  class="btn btn-outline-secondary btn-sm"
                  [routerLink]="['/products', product.id, 'edit']"
                >
                  Edit
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No Products -->
      <div class="text-center mt-5" *ngIf="!isLoading && !errorMessage && products.length === 0">
        <h4 class="text-muted">No products found</h4>
        <p class="text-muted">Try adjusting your filters or add some products.</p>
      </div>

      <!-- Pagination -->
      <nav *ngIf="!selectedCategoryId && totalPages > 1" class="mt-4">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
              Previous
            </button>
          </li>
          <li class="page-item" *ngFor="let page of pages" [class.active]="page === currentPage">
            <button class="page-link" (click)="onPageChange(page)">{{ page }}</button>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">
              Next
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
